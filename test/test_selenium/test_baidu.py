# Generated by Selenium IDE
import pytest
import time

import yaml
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.support import expected_conditions
from selenium.webdriver.support.wait import WebDriverWait


class TestBaidu():
    def setup_method(self):
        self.driver = webdriver.Chrome()

    def teardown_method(self):
        self.driver.quit()

    def test_baidu(self):
        self.driver.get("https://www.baidu.com/")
        self.driver.find_element(By.ID, "kw").click()
        self.driver.find_element(By.ID, "kw").send_keys("霍格沃兹测试学院")
        self.driver.find_element(By.ID, "su").click()


# 第一步复用浏览器，拿到cookie
# 第二步拿到cookie，传递给selenium，设置cookie，打开新的浏览器
def test_login():
    # 复用浏览器，拿到cookie
    opt = webdriver.ChromeOptions()
    opt.debugger_address = "127.0.0.1:9222"
    driver = webdriver.Chrome(options=opt)
    driver.get("https://work.weixin.qq.com/wework_admin/frame")
    driver.find_element_by_id("menu_contacts").click()
    cookies = driver.get_cookies()
    with open("data.yaml", "w", encoding="UTF-8") as f:
        yaml.dump(cookies, f)
    # print(driver.get_cookies())


# cookie放在代码中
def test_wework():
    # 打开新的浏览器，设置cookie，跳过扫码登录
    driver = webdriver.Chrome()
    driver.get("https://work.weixin.qq.com/wework_admin/loginpage_wx")
    cookies = [
        {'domain': '.work.weixin.qq.com', 'httpOnly': False, 'name': 'wwrtx.cs_ind', 'path': '/', 'secure': False,
         'value': 'edutrain'},
        {'domain': '.work.weixin.qq.com', 'httpOnly': False, 'name': 'wwrtx.vid', 'path': '/', 'secure': False,
         'value': '1688850234005689'},
        {'domain': '.work.weixin.qq.com', 'httpOnly': False, 'name': 'wxpay.vid', 'path': '/', 'secure': False,
         'value': '1688850234005689'},
        {'domain': '.qq.com', 'expiry': 2147385600, 'httpOnly': False, 'name': 'pgv_pvid', 'path': '/', 'secure': False,
         'value': '9808192407'},
        {'domain': '.work.weixin.qq.com', 'httpOnly': False, 'name': 'wxpay.corpid', 'path': '/', 'secure': False,
         'value': '1970324955464738'},
        {'domain': '.qq.com', 'expiry': 1624625540, 'httpOnly': False, 'name': '_gid', 'path': '/', 'secure': False,
         'value': 'GA1.2.239741311.1624505533'},
        {'domain': '.work.weixin.qq.com', 'httpOnly': True, 'name': 'wwrtx.sid', 'path': '/', 'secure': False,
         'value': 'vMhpg3xumQOv6cs6LA-N5BklJhzh5NPMNs96pjwGS2qywbI8lpdcicwOy2qya85S'},
        {'domain': '.work.weixin.qq.com', 'httpOnly': False, 'name': 'wwrtx.d2st', 'path': '/', 'secure': False,
         'value': 'a6978440'},
        {'domain': '.work.weixin.qq.com', 'httpOnly': False, 'name': 'Hm_lpvt_9364e629af24cb52acc78b43e8c9f77d',
         'path': '/', 'secure': False, 'value': '1624539131'},
        {'domain': '.qq.com', 'expiry': 1653741400, 'httpOnly': False, 'name': 'ied_qq', 'path': '/', 'secure': False,
         'value': 'o1140341230'},
        {'domain': '.work.weixin.qq.com', 'httpOnly': True, 'name': 'wwrtx.refid', 'path': '/', 'secure': False,
         'value': '03129635'},
        {'domain': 'work.weixin.qq.com', 'expiry': 1624570362, 'httpOnly': True, 'name': 'ww_rtkey', 'path': '/',
         'secure': False, 'value': '1k4bo6d'},
        {'domain': '.work.weixin.qq.com', 'httpOnly': True, 'name': 'wwrtx.vst', 'path': '/', 'secure': False,
         'value': 'p0eKQL6wdRjQjYHa7Uhk2tJyZjar5_z93ktN9t9TtlBXOc4fAYcIOGlnEzBZCbE1NG3ErlD0P4Bj4usVubmMrsnYjkw9hNGHfGJbaCnpmJSwwgS0sCOmADr82JjImXQSMuqjM6_FhvOxCQ9XrADfwoDUcXgWwtV44uuPypYi6YJ3QPF-UYDXSN-9JcKbsnE0o5DXL357FkkwgMiQV8TUhoNJ-EMSjrnApT9LWlVxP3RzTZEhc6XFrxWG-GyZODyqrobvLv31UVTRyiw_mxfefQ'},
        {'domain': '.work.weixin.qq.com', 'expiry': 1656075131, 'httpOnly': False,
         'name': 'Hm_lvt_9364e629af24cb52acc78b43e8c9f77d', 'path': '/', 'secure': False,
         'value': '1624505532,1624536117,1624538827,1624539131'},
        {'domain': '.qq.com', 'expiry': 1939614054, 'httpOnly': False, 'name': 'pac_uid', 'path': '/', 'secure': False,
         'value': '1_1140341230'},
        {'domain': '.qq.com', 'expiry': 2147385600, 'httpOnly': False, 'name': 'o_cookie', 'path': '/', 'secure': False,
         'value': '1140341230'},
        {'domain': '.qq.com', 'expiry': 1653741400, 'httpOnly': False, 'name': 'uin_cookie', 'path': '/',
         'secure': False, 'value': 'o1140341230'},
        {'domain': '.qq.com', 'expiry': 1653103831, 'httpOnly': False, 'name': 'eas_sid', 'path': '/', 'secure': False,
         'value': 'G1T6o2I1m546T7R8A3S1E850i9'},
        {'domain': '.work.weixin.qq.com', 'expiry': 1627132283, 'httpOnly': False, 'name': 'wwrtx.i18n_lan',
         'path': '/', 'secure': False, 'value': 'zh'},
        {'domain': '.qq.com', 'expiry': 1687611140, 'httpOnly': False, 'name': '_ga', 'path': '/', 'secure': False,
         'value': 'GA1.2.2094456598.1621221576'},
        {'domain': '.work.weixin.qq.com', 'expiry': 1652757574, 'httpOnly': False, 'name': 'wwrtx.c_gdpr', 'path': '/',
         'secure': False, 'value': '0'},
        {'domain': '.qq.com', 'expiry': 2147483647, 'httpOnly': False, 'name': 'ptcz', 'path': '/', 'secure': False,
         'value': '0f87db21e8489fe1b509d625944d610b6425af692af37fbb91b7cf675512b674'},
        {'domain': '.work.weixin.qq.com', 'httpOnly': True, 'name': 'wwrtx.ltype', 'path': '/', 'secure': False,
         'value': '1'},
        {'domain': '.work.weixin.qq.com', 'httpOnly': True, 'name': 'wwrtx.ref', 'path': '/', 'secure': False,
         'value': 'direct'},
        {'domain': '.qq.com', 'expiry': 1627106626, 'httpOnly': False, 'name': 'lskey', 'path': '/', 'secure': False,
         'value': '0001000017893983a1470390e27199fcefa24a9167e18293c7aad43fe4dfac5eec8646d15edbeada27a95489'},
        {'domain': '.qq.com', 'expiry': 2147483646, 'httpOnly': False, 'name': 'RK', 'path': '/', 'secure': False,
         'value': 'VhyEX0K/ZZ'},
        {'domain': '.qq.com', 'expiry': 1624540340, 'httpOnly': False, 'name': '_gat', 'path': '/', 'secure': False,
         'value': '1'},
        {'domain': '.qq.com', 'expiry': 1627106626, 'httpOnly': False, 'name': 'luin', 'path': '/', 'secure': False,
         'value': 'o1140341230'}]
    for cookie in cookies:
        driver.add_cookie(cookie)
    driver.get("https://work.weixin.qq.com/wework_admin/frame#profile")
    time.sleep(5)
    driver.quit()


# 从yaml文件读取cookie
def test_load_cookie():
    driver = webdriver.Chrome()
    driver.get("https://work.weixin.qq.com/wework_admin/loginpage_wx")
    with open("data.yaml", encoding="UTF-8") as f:
        yaml_data = yaml.safe_load(f)
    for cookie in yaml_data:
        driver.add_cookie(cookie)
    driver.get("https://work.weixin.qq.com/wework_admin/frame#profile")
    time.sleep(5)
    driver.quit()


def test_add_member():
    opt = webdriver.ChromeOptions()
    opt.debugger_address = "127.0.0.1:9222"
    driver = webdriver.Chrome(options=opt)
    driver.implicitly_wait(10)
    driver.get("https://work.weixin.qq.com/wework_admin/frame")
    driver.find_element_by_id("menu_contacts").click()
    ele = (By.CSS_SELECTOR, ".ww_operationBar .js_add_member")
    WebDriverWait(driver, 10).until(expected_conditions.element_to_be_clickable(ele))
    driver.find_element_by_css_selector(".ww_operationBar .js_add_member").click()
    driver.find_element_by_id("username").send_keys("张三1")
    driver.find_element_by_id("memberAdd_acctid").send_keys("1236781")
    driver.find_element_by_id("memberAdd_mail").send_keys("12300011@qq.com")
    driver.find_element_by_css_selector(".js_btn_save").click()
    eles = driver.find_elements_by_css_selector(".member_colRight_memberTable_td:nth-child(2)")
    print(eles)
    for x in eles:
        if x.get_attribute("title") == "张三1":
            return True
